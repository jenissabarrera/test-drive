<!DOCTYPE html>
<html>

<head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
		integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<script src="https://apps.mypurecloud.com/widgets/9.0/cxbus.min.js"
		onload="javascript:CXBus.configure({debug:false,pluginsPath:'https://apps.mypurecloud.com/widgets/9.0/plugins/'}); CXBus.loadPlugin('widgets-core');">
	</script>
	<script src='https://code.jquery.com/jquery-3.3.1.min.js'
		integrity='sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=' crossorigin='anonymous'></script>
	<script src="https://sdk-cdn.mypurecloud.com/javascript/62.0.0/purecloud-platform-client-v2.min.js"></script>
	<script src="https://sdk-cdn.mypurecloud.com/client-apps/1.3.0/purecloud-client-app-sdk.js"></script>
	<title> Test Drive App </title>
</head>

<body>
	
	<button type="button" id="chat-button-simple" class="btn" onclick="startChat()">Start Chat</button>
	<div>
		<iframe width="100%" height="100%" style="position: absolute;" src=https://testdrive.genesys.com/> </iframe>
	</div> 
</body> 
</html> 

<!-- Import purecloud webchat api -->
<script id="purecloud-webchat-js" type="text/javascript"
			src="https://apps.mypurecloud.com/webchat/jsapi-v1.js" region="us-east-1"
			org-guid="03671e89-0883-48b0-8284-cd5260c38745" deployment-key="e020b006-2284-429e-901d-fdd836c258e1">
</script>

			<script type="text/javascript">
				const clientId = '282c9370-5e3c-4b4d-8bee-467fb8adde70';
				const redirectUri = window.location.href;
				const platformClient = require('platformClient');
				const client = platformClient.ApiClient.instance;
				let UsersApi = new platformClient.UsersApi();
				let userData = {};
				let ClientApp = window.purecloud.apps.ClientApp;
					let myClientApp = new ClientApp({
					pcEnvironmentQueryParam: 'pcEnvironment'
				});
	
			
				// import clientIds from './scripts/clientIDs.js';
				
				

			
				// document.addEventListener('DOMContentLoaded', function () {
				// 	var ClientApp = window.purecloud.apps.ClientApp;
				// 	var myClientApp = new ClientApp({
				// 		pcEnvironmentQueryParam: 'pcEnvironment'
				// 	});


				// myClientApp.alerting.showToastPopup('Hello', 'PureCloud');c
				// });

				$(document).ready(() => {
		
					client.loginImplicitGrant(clientId, redirectUri)
						.then(() => {
							let token = client.authData.accessToken;
							getUser();
						})
						.catch((err) => console.error(err));
				})

				function getUser() {
					let opts = {
						'expand': ["organization"] // [String] | Which fields, if any, to expand.
					};

					UsersApi.getUsersMe(opts)
						.then((data) => {
							userData = data;
							console.log(`getUsersMe success! data: ${JSON.stringify(userData, null, 2)}`);
						})
						.catch((err) => {
							console.log('There was a failure calling getUsersMe');
							console.error(err);
						});

				}

				function startChat() {

					let chatConfig = {
						"webchatAppUrl": "https://apps.mypurecloud.com/webchat",
						"webchatServiceUrl": "https://realtime.mypurecloud.com:443",
						"orgId": userData.organization.thirdPartyOrgId,
						"orgGuid": userData.organization.id,
						"orgName": userData.organization.thirdPartyOrgName,
						"queueName": "Test Drive Sample Queue",
						"logLevel": "DEBUG",
						"locale": "en",
						"data": {
							"firstName": userData.name,
							"email": userData.email
						},
						"companyLogo": {
							"width": 600,
							"height": 149,
							"url": "https://d3a63qt71m2kua.cloudfront.net/developer-tools/1438/assets/images/PC-blue-nomark.png"
						},
						"companyLogoSmall": {
							"width": 25,
							"height": 25,
							"url": "https://d3a63qt71m2kua.cloudfront.net/developer-tools/1438/assets/images/companylogo.png"
						},
						"agentAvatar": {
							"width": 462,
							"height": 462,
							"url": "https://d3a63qt71m2kua.cloudfront.net/developer-tools/1438/assets/images/agent.jpg"
						},
						"welcomeMessage": "Thanks for reaching Test Drive support. Please wait for a while.",
						"cssClass": "webchat-frame",
						"css": {
							"width": "100%",
							"height": "100%"
						}
					};


					ININ.webchat.create(chatConfig, function (err, webchat) {
						if (err) {
							console.error(err);
							throw err;
						}

						webchat.renderPopup({
							width: 400,
							height: 400,
							title: 'Chat'
						});
					});


				}
			</script>